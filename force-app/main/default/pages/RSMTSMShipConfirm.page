<!--
 - Copyright (c) 2018 Filigreen Distro
 - All rights reserved.
 - RSMTSMShipConfirm
-->
<apex:page controller="RSMTSMShipConfirmCotroller"
           title="RSM/TSM Ship Confirm"
           sidebar="false"
           showheader="true"
           id="pageId"
           standardstylesheets="true"
           lightningStylesheets="true" docType="html-5.0">

    <head>
        <apex:includescript value="{!URLFOR($Resource.RSMTSMShipConfirm, '/js/jquery_min_1.11.3.js')}" />
        <apex:includescript value="{!URLFOR($Resource.RSMTSMShipConfirm, '/js/bootstrap_min_3.3.6.js')}" />

        <apex:stylesheet value="{!URLFOR($Resource.RSMTSMShipConfirm, '/css/bootstrap_min_3.3.6.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.RSMTSMShipConfirm, '/css/custom.css')}" />
		<style>
        	.datePicker, #datePicker{
            	z-index:9999;
            }
            body .pbBody table.list tr.headerRow td, body .pbBody table.list tr.headerRow th{
            	font-size:8px!important;
            	white-space: normal!important;
            }
        </style>
               
    </head>
    <script type="text/javascript" src="https://maps.google.com/maps/api/js?key={!$Label.Google_Map_API_Key}"></script>

    <script>
        var previousOnload = window.onload;
        window.onload = function() {
        if (previousOnload) { previousOnload(); } retrieveRSMTSMs(); }

        var geocoder;
        var map;
        var addressesArray = [];
        var SEPERATOR = '{!SEPERATOR}';
        
        function getSelectedRSMTSMJS(selectedRSMTSMId, isRSM, cannotShipConfirm){
            if(cannotShipConfirm == 'true'){
             
                alert('Please Complete Depart Confirm and try again to Ship Confirm');
                $('#myModal').modal('hide');
                $('body').removeClass('modal-open');
                $('.modal-backdrop').remove();
                return false;
            }else{
               
                getSelectedRSMTSM(selectedRSMTSMId, isRSM);
                $('#myModal').modal('show');
                return true;
            }
        }

        function initialize() {
            var latlng = new google.maps.LatLng(34.391663, -118.542587);

            // Get selected RSM/TSM addresses in string format
            var addressesString = document.getElementById('selectedAddresses').value;

            // Split string into list
            addressesArray = addressesString.split(SEPERATOR);
            var mapOptions = {
                zoom: 9,
                center: latlng
            }
            var directionsService = new google.maps.DirectionsService;
            map = new google.maps.Map(document.getElementById('map'), mapOptions);
            var directionsDisplay = new google.maps.DirectionsRenderer({map: map, suppressMarkers: true});

            calculateAndDisplayRoute(directionsService, directionsDisplay);
        }

        function calculateAndDisplayRoute(directionsService, directionsDisplay) {

            var waypts = [];

            // Add all addresses into way points
            // Do not add first and last address as they are default source and destination address
            for (var i = 1; i < addressesArray.length - 2; i++) {
                addressesArray[i] = addressesArray[i].trim();
                console.log(addressesArray[i]);
                if(addressesArray[i] != SEPERATOR && addressesArray[i] != ''){
                    waypts.push({
                      location: addressesArray[i],
                      stopover: true
                    });
                }
            }

            // Specify route options
            directionsService.route({
                origin: addressesArray[0],
                destination: addressesArray[addressesArray.length - 2],
                waypoints: waypts,
                optimizeWaypoints: true, // Get optimized way
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            }, function(response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                    var route = response.routes[0];
                    var total = 0;
                    var distanceValue = 0;
                    var summaryPanel = document.getElementById('directionsPanel');
                    summaryPanel.innerHTML = '';

                    // For each route, display summary information.
                    for (var i = 0; i < route.legs.length - 1; i++) {

                        var routeSegment = i + 1;

                        var marker = new google.maps.Marker({
                            position: route.legs[i].end_location,
                            label: {
                                text: ""+(routeSegment),
                                color: 'white'
                            },
                            title: route.legs[i].end_address,
                            map: map
                        });

                        console.log(i + ' = ' + route.legs[i]);
                        summaryPanel.innerHTML += '<b>Route Segment: ' + routeSegment +
                        '</b><br>';
                        summaryPanel.innerHTML += route.legs[i].start_address + ' to ';
                        summaryPanel.innerHTML += route.legs[i].end_address + '<br>';
                        distanceValue = (route.legs[i].distance.value)/1000; // Distance in KM
                        distanceValue = (distanceValue * 0.6214); // Distance in miles
                        summaryPanel.innerHTML += (distanceValue).toFixed(2) + ' mile(s)<br><br>'; // Distance in KM
                        total += distanceValue;
                    }
                    summaryPanel.innerHTML += '<b>Total Distance:</b> ' + total.toFixed(2) + ' mile(s)<br><br>';
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        }

        // select all checkboxes of rsm lines to cancel
        function selectAllCheckboxes(obj){
            var inputCheckBox = document.getElementsByTagName("input");
            for(var i=0; i<inputCheckBox.length; i++){
                if(!inputCheckBox[i].disabled){
                    inputCheckBox[i].checked = obj.checked;
                }
            }
        }

        // JS to close bootstrap modal only if there is no error on action
        function closeModalWindow(errorFlag){
            if(errorFlag == 'false'){
                $('#myModal').modal('hide');
                $('body').removeClass('modal-open');
                $('.modal-backdrop').remove();
            }		
        }
    
     function errorCall(errorFlag){
            if(errorFlag){
                var a  = errorFlag;
               	$('#errorModal').modal('show');
                document.getElementById("errorMessage1").innerHTML = a;
            }	
        }
    </script>
    <apex:form id="formId">
       
        <apex:actionfunction name="getSelectedRSMTSM"
                             action="{!getSelectedRSMTSM}"
                             rerender="dialogModalId"
                             status="idRefreshingStatus">
            <apex:param name="selectedRSMTSMId"
                        value=""
                        assignto="{!selectedRSMTSMId}" />
            <apex:param name="isRSM"
                        value=""
                        assignto="{!isRSM}" />
        </apex:actionfunction>

        <apex:actionfunction name="displayDepartConfirmButton"
                             action="{!displayDepartConfirmButton}"
                             rerender="buttonSectionId"
                             status="idRefreshingStatus" />

        <apex:actionfunction name="retrieveRSMTSMs"
                             action="{!retrieveRSMTSMs}"
                             oncomplete="initialize()"
                             rerender="selected-section-display, errorId, displayMapRoute"
                             status="idRefreshingStatus" />
        
        <apex:actionFunction name="reloadPage" action="{!reloadPage}"/>

        <apex:pageblock id="pbId">
            <apex:pagemessages id="errorId" />
            <apex:actionstatus id="idRefreshingStatus"
                               style="align:center">
                <apex:facet name="start">
                    <div class="grey-background">
                        &nbsp;
                    </div>
                    <div class="loading-image">
                        <img src="/img/loading.gif" />
                    </div>
                </apex:facet>
            </apex:actionstatus>
            
            <apex:pageblocksection columns="1">
                
                <apex:outputlabel >
                    <apex:outputlabel escape="false" value="<b>Date:</b>" />&nbsp;&nbsp;&nbsp; 
                    <apex:selectList value="{!selectedDay}" size="1" 
                                     onchange="reloadPage()">
                        <apex:selectOptions value="{!dateSelectionOptions}" />
                    </apex:selectList>
                </apex:outputlabel>
               
            </apex:pageblocksection>

            <!-- Display selected list of RSM/TSMs -->

            <apex:pageblocksection id="selected-section-display" columns="1">

                <apex:outputpanel id="selectedRSMTSMPanel" rendered="{!displayMapResult}">
                    <div style="height:13.5rem; overflow-y:scroll; border:solid 2px grey;">
                        <apex:pageblocktable value="{!selectedList}" var="rsmtsmObj" style="table-layout:unset">
                            <apex:column style="font-size: 0.6rem;font-weight: 200;">
                                <apex:facet name="header">Depart  Confirm</apex:facet>
                                <apex:outputpanel >
                                    <apex:inputcheckbox value="{!rsmtsmObj.departConfirmSelection}"
                                                        onclick="displayDepartConfirmButton()"
                                                        rendered="{!rsmtsmObj.actualDepartureDateTime == null}" />
                                </apex:outputpanel>
                            </apex:column>
                            
                            <apex:column style="font-size: 0.6rem;font-weight: 200;">
                                <apex:facet name="header">Ship Confirm</apex:facet>
                                <input type="radio" name="selectRadio" id="radioId" 
                                       onclick="return getSelectedRSMTSMJS('{!rsmtsmObj.Id}', '{!rsmtsmObj.isRSM}', '{!rsmtsmObj.cannotShipConfirm}')"
                                        />

                            </apex:column>
                            
                            <apex:column headervalue="Priority" style="font-size: 0.6rem;font-weight: 200;">
                                {!rsmtsmObj.priority}
                            </apex:column>
                            <apex:column style="font-size: 0.6rem;font-weight: 200;">
                                <apex:facet name="header">Window Start &amp; End</apex:facet>
                                {!rsmtsmObj.windowStartEnd}
                            </apex:column>
                            <apex:column style="font-size: 0.6rem;font-weight: 200;">
                                <apex:facet name="header">Manifest #</apex:facet>
                                <apex:outputlink value="/{!rsmtsmObj.Id}">{!rsmtsmObj.Name}</apex:outputlink>
                            </apex:column>
                            <apex:column headervalue="Metrc #" style="font-size: 0.6rem;font-weight: 200;">
                                {!rsmtsmObj.manifest}
                            </apex:column>
                            <apex:column headervalue="Order #" style="font-size: 0.6rem;font-weight: 200;">
                                <apex:outputlink value="/{!rsmtsmObj.orderid}">{!rsmtsmObj.ordername}</apex:outputlink>
                            </apex:column>
                            <apex:column style="font-size: 0.6rem;font-weight: 200;">
                            	<apex:facet name="header">Payment Terms</apex:facet>
                                {!rsmtsmObj.paymentTerms}
                            </apex:column>
                            <apex:column style="font-size: 0.6rem;font-weight: 200;">
                                <apex:facet name="header">Business Name</apex:facet>
                                <apex:outputlink value="/{!rsmtsmObj.accountId}">{!rsmtsmObj.accountName}</apex:outputlink>
                            </apex:column>
                            <apex:column headervalue="Address" value="{!rsmtsmObj.deliveryAddress}" style="font-size: 0.6rem;font-weight: 200;"/>
                            <apex:column headervalue="Contact" style="font-size: 0.6rem;font-weight: 200;">
                                <apex:outputlink value="/{!rsmtsmObj.receiverContactId}">{!rsmtsmObj.receiverContactName}</apex:outputlink>
                            </apex:column>
                            <apex:column style="font-size: 0.6rem;font-weight: 200;" headervalue="Phone" value="{!rsmtsmObj.receiverPhone}" />
                            <!--apex:column headervalue="RSM/TSM Name">
                                <apex:outputlink value="/{!rsmtsmObj.Id}">{!rsmtsmObj.Name}</apex:outputlink>
                            </apex:column-->
                            
                            <!--apex:column >
                                <apex:facet name="header">Planned Ship <br /> Date(RSM) / Planned <br /> Transfer Date(TSM)</apex:facet>
                                <apex:outputtext value="{0,date,MM/dd/yyyy}">
                                    <apex:param value="{!rsmtsmObj.plannedShipTransferDate}" />
                                </apex:outputtext>
                            </apex:column>
                            
                            
                            <apex:column headervalue="Driver">
                                <apex:outputlink value="/{!rsmtsmObj.driverId}">{!rsmtsmObj.driverName}</apex:outputlink>
                            </apex:column>
                            <apex:column headervalue="Vehicle">
                                <apex:outputlink value="/{!rsmtsmObj.vehicleId}">{!rsmtsmObj.vehicleName}</apex:outputlink>
                            </apex:column>
                            
                            <apex:column headervalue="Receiver Email" value="{!rsmtsmObj.receiverEmail}" /-->
                            <apex:column style="font-size: 0.6rem;font-weight: 200;">
                                <apex:facet name="header">Box Count</apex:facet>
                                <apex:outputlabel value="{!rsmtsmObj.boxCount}" />
                            </apex:column>
                            <apex:column style="font-size: 0.6rem;font-weight: 200;">
                                <apex:facet name="header">Pending Invoices</apex:facet>
                                <apex:outputlabel value="{!rsmtsmObj.pendingInvoices}" />
                            </apex:column>
                        </apex:pageblocktable>
                    </div>
                </apex:outputpanel>
                <apex:outputlabel id="buttonSectionId">
                    <apex:commandbutton value="Depart Confirm"
                                        action="{!departConfirmAction}"
                                        rerender="selectedRSMTSMPanel, dialogModalId,buttonSectionId"
                                        rendered="{!displayDepartConfirm}"
                                        oncomplete="errorCall('{!errorMessage}')"
                                        status="idRefreshingStatus"  />
                    
                </apex:outputlabel>

                <input type="hidden" value="{!selectedAddresses}" id="selectedAddresses" />
            </apex:pageblocksection>

            <!-- Place to display route direction -->
            <apex:outputpanel id="displayMapRoute" style="display: {!If(displayMapResult, '', 'none')}">
                <div id="directionsPanel"></div>
            </apex:outputpanel>
        </apex:pageblock>

        <!-- Place to display google map -->
        <div id="map" style="height: 480px;" />
        <div class="bs">

        <!--Error -->
            
            <div class="modal fade" id="errorModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-md" role="document">
                    <div class="modal-content">
                        <div class="modal-body" style="background-color: rgb(181, 65, 61)!important; color:white">
                            <p id="errorMessage1" style="text-align:center">
                                
                            </p>
                            
                        </div>
                    </div>
                </div>
            </div>
        <!-- Pop up modal to display RSM/TSM and process ship confirm and cancel RSM logic -->
            <div class="panel panel-info">
                <div class="panel-heading"></div>
                <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" style="margin:auto;position:absolute;overflow-y:auto;overflow-x:auto">
                    <apex:outputpanel id="dialogModalId">
                        <div class="modal-dialog" role="document" style="width:66rem;">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                    <h4 class="modal-title" id="myModalLabel">RSM/TSM Details</h4>
                                </div>
                                <apex:pagemessages />
                                <div class="modal-body row">
                                    <!-- Display RSM details -->
                                    <apex:outputpanel id="rsmEdit" rendered="{!selectedRSMTSMId != null && isRSM}">
                                        <div class="col-xs-6">
                                            <div class="form-group col-xs-12" style="margin-bottom: 8px;">
                                                <label style="width:20%;">Business Name</label>
                                                <span>
                                                    <apex:outputfield value="{!rsmSO.Receiver_Name__r.DBA__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12" style="margin-bottom: 8px;">
                                                <label style="width:20%;">Manifest #</label>
                                                <span >
                                                    <apex:outputlink value="/{!rsmSO.Id}">{!rsmSO.Name}</apex:outputlink>
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12" style="margin-bottom: 8px;">
                                                <label style="width:20%;">Metrc #</label>
                                                <span>
                                                    <apex:outputfield value="{!rsmSO.Metrc_Manifest__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12" style="margin-bottom: 8px;">
                                                <label style="width:20%;">Order #</label>
                                                <span>
                                                    <apex:outputlink value="/{!rsmSO.Order_Number__c}">{!rsmSO.Order_Number__r.Name}</apex:outputlink>
                                                </span>
                                            </div>
                                            <!--div class="form-group col-xs-12">
                                                <label>TSM/RSM Name</label>
                                                <span style="margin-left:1rem">
                                                    <apex:outputfield value="{!rsmSO.Name}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            
                                            <div class="form-group col-xs-12">
                                                <label>PO Number</label>
                                                <span style="margin-left:2.6rem">
                                                    <apex:outputfield value="{!rsmSO.Customer_PO_or_Quote__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12">
                                                <label>Payment Terms</label>
                                                <span style="margin-left:1rem">
                                                    <apex:outputfield value="{!rsmSO.Payment_Terms__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12">
                                                <label>{!$ObjectType.Shipping_Manifest__c.Fields.Driver__c.Label}</label>
                                                <span style="margin-left:4.6rem">
                                                    <apex:outputfield value="{!rsmSO.Driver__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12">
                                                <label>{!$ObjectType.Shipping_Manifest__c.Fields.Vehicle__c.Label}</label>
                                                <span style="margin-left:4.2rem">
                                                    <apex:outputfield value="{!rsmSO.Vehicle__c}" styleclass="form-control" />
                                                </span>
                                            </div-->
                                        </div>
                                        <div class="col-xs-6">
                                            <div class="form-group col-xs-12" style="margin-bottom: 8px;">
                                                <label style="width:20%;">Ship / Transfer Date</label>
                                                <apex:inputfield id="shipDate" value="{!rsmSO.Planned_Ship_Transfer_Date__c}" style="width:10rem; display:inline;" />
                                            </div>
                                            <div class="form-group col-xs-12" style="margin-bottom: 8px;">
                                                <label style="width:20%;">{!$ObjectType.Shipping_Manifest__c.Fields.Driver__c.Label}</label>
                                                <span>
                                                    <apex:outputfield value="{!rsmSO.Driver__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12" style="margin-bottom: 8px;">
                                                <label style="width:20%;">{!$ObjectType.Shipping_Manifest__c.Fields.Vehicle__c.Label}</label>
                                                <span>
                                                    <apex:outputfield value="{!rsmSO.Vehicle__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12" style="margin-bottom: 8px;">
                                                <label style="width:20%;">Payment Terms</label>
                                                <span>
                                                    <apex:outputfield value="{!rsmSO.Payment_Terms__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <!--div class="form-group col-xs-12">
                                                <label>Actual Departure <br /> Date and time</label>
                                                <apex:inputfield value="{!rsmSO.Actual_Departure_Date_Time__c}" styleclass="form-control" style="width:10rem; display:inline; margin-left:5rem" />
                                            </div>
                                            <div class="form-group col-xs-12">
                                                <label>Actual Arrival <br /> Date and time</label>
                                                <apex:inputfield value="{!rsmSO.Actual_Arrival_Date_Time__c}" styleclass="form-control" style="width:10rem; display:inline; margin-left:6rem" />
                                            </div>
                                            <div class="form-group col-xs-12">
                                                <label>Receiver Acceptance Date</label>
                                                <apex:inputfield value="{!rsmSO.Receiver_Acceptance_Date__c}" styleclass="form-control" style="width:10rem; display:inline; margin-left:1.5rem" />
                                            </div-->
                                        </div>
                                    </apex:outputpanel>
                                    
                                  
                                    <!-- Display TSM details -->
                                    <apex:outputpanel id="tsmEdit" rendered="{!selectedRSMTSMId != null && !isRSM}">
                                        <div class="col-xs-5">
                                            <div class="form-group col-xs-12">
                                                <label>TSM/RSM Name</label>
                                                <span style="margin-left:1rem">
                                                    <apex:outputfield value="{!tsmSO.Name}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12">
                                                <label>DBA Name</label>
                                                <span style="margin-left:2.9rem">
                                                    <apex:outputfield value="{!tsmSO.Supplier_Name__r.DBA__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12">
                                                <label>PO Number</label>
                                                <span style="margin-left:2.6rem">
                                                    <apex:outputfield value="{!tsmSO.Purchase_Order__r.Name}" styleclass="form-control" />
                                                </span>
                                            </div>                                            
                                            <div class="form-group col-xs-12">
                                                <label>Payment Terms</label>
                                                <span style="margin-left:1rem">
                                                    <apex:outputfield value="{!tsmSO.Payment_Terms__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12">
                                                <label>{!$ObjectType.Shipping_Manifest__c.Fields.Driver__c.Label}</label>
                                                <span style="margin-left:4.6rem">
                                                    <apex:outputfield value="{!tsmSO.Driver__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                            <div class="form-group col-xs-12">
                                                <label>{!$ObjectType.Shipping_Manifest__c.Fields.Vehicle__c.Label}</label>
                                                <span style="margin-left:4.2rem">
                                                    <apex:outputfield value="{!tsmSO.Vehicle__c}" styleclass="form-control" />
                                                </span>
                                            </div>
                                        </div>
                                        <div class="col-xs-7">
                                            <table border="0" style="width:100%;">
                                                <tr style="display: block; margin-bottom: 15px; height: 24px;">
                                                	<td style="width: 200px;">
                                                    	<label>Planned Transfer Date</label>
                                                    </td>
                                                    <td>
                                                    	<apex:inputfield value="{!tsmSO.Planned_Ship_Transfer_Date__c}" styleclass="form-control" style="display:inline;" />
                                                    </td>
                                                </tr>
                                                <tr  style="display: block; margin-bottom: 15px; height: 24px;">
                                                	<td style="width: 200px;">
                                                    	<label >Actual Departure Date/Time</label>
                                                    </td>
                                                    <td>
														<apex:inputfield value="{!tsmSO.Actual_Departure_Date_Time__c}" styleclass="form-control" style="display:inline;" />                                                    
                                                    </td>
                                                </tr>
                                                <tr style="display: block; margin-bottom: 15px; height: 24px;">
                                                	<td style="width: 200px;">
                                                    	<label>Actual Arrival Date/Time</label>
                                                    </td>
                                                    <td>
                                                    	<apex:inputfield value="{!tsmSO.Actual_Arrival_Date_Time__c}" styleclass="form-control" style="display:inline;" />
                                                    </td>
                                                </tr>
                                                <tr style="display: block; margin-bottom: 15px; height: 24px;">
                                                	<td style="width: 200px;">
                                                    	<label>Receiver Acceptance Date</label>
                                                    </td>
                                                    <td>
                                                    	<apex:inputfield value="{!tsmSO.Receiver_Acceptance_Date__c}" styleclass="form-control" style="display:inline;" />
                                                    </td>
                                                </tr>
                                            </table>
                                            
                                        </div>
                                    </apex:outputpanel>
                                </div>
                                
                                <h4 class="modal-title" style="margin-left: 2%;">RSM/TSM Lines</h4>
                                <div class="modal-body row" style="height:250px; margin-left:0.5rem;margin-right:2rem;margin-top:1rem;overflow-y: auto;overflow-x: hidden;">
                                    <!-- Display RSM lines -->
                                    
                                    <apex:outputpanel id="rsmLinesTableId">
                                        <div class="panel-body">
                                            <table class="table table-condensed">
                                                <tr>
                                                    <th style="padding:5px!important">Line ID</th>
                                                    <th>Product Name</th>
                                                    <th>Product Description</th>
                                                    <th>Brand Name</th>
                                                    <th>Shipment Qty</th>
                                                    <th>Subtotal Price</th>
                                                    <th>Qty Received</th>
                                                    <th>Rejection Reason</th>
                                                    <!--th>Line Total Price</th>
                                                    <th>Picklist Line</th>
                                                    <th>SO Line</th-->
                                                </tr>
                                                <apex:repeat value="{!rsmLines}" var="rsmLine">
                                                    <tr>
                                                        <td>
                                                            <apex:outputlink value="/{!rsmLine.rsmLineSO.Id}" target="__blank">{!rsmLine.rsmLineSO.Name}</apex:outputlink>
                                                        </td>
                                                        <td>
                                                            <apex:outputfield value="{!rsmLine.rsmLineSO.Product_Name__c}" />
                                                        </td>
                                                        <td>
                                                            <apex:outputfield value="{!rsmLine.rsmLineSO.Product_Description__c}" />
                                                        </td>
                                                        <td>
                                                            <apex:outputfield value="{!rsmLine.rsmLineSO.Producer_Name__c}" />
                                                        </td>
                                                        <td>
                                                            
                                                            <apex:outputfield value="{!rsmLine.rsmLineSO.Shipment_Qty__c}" 
                                                            style="width:60px" rendered="{!isRSM}" />
                                                            <apex:outputfield value="{!rsmLine.rsmLineSO.Qty_Ordered__c}" 
                                                            style="width:75px" rendered="{!!isRSM}" />
                                                             
                                                        </td>
                                                        <td>
                                                            <apex:outputfield value="{!rsmLine.rsmLineSO.Retail_Wholesale_Price__c}" rendered="{!isRSM}"/>
                                                            <apex:outputfield value="{!rsmLine.rsmLineSO.Unit_Cost__c }" rendered="{!!isRSM}"/>
                                                        </td>
                                                        <td>
                                                            <apex:inputText value="{!rsmLine.qtyToReceive}" 
                                                            style="width:60px" rendered="{!isRSM}"/>
                                                            <apex:outputText value="{!rsmLine.rsmLineSO.Qty_Ordered__c}" 
                                                             rendered="{!!isRSM}" />
                                                        </td>
                                                        <td>
                                                            <apex:inputfield value="{!rsmLine.rsmLineSO.Rejection_Reason__c}"  rendered="{!isRSM}"/>
                                                            <apex:outputfield value="{!rsmLine.rsmLineSO.Rejection_Reason__c}"  rendered="{!!isRSM}"/>
                                                        </td>
                                                        <!--td>
                                                            <apex:outputfield value="{!rsmLine.rsmLineSO.Picklist_Line__c}" />
                                                        </td>
                                                        <td>
                                                            <apex:outputfield value="{!rsmLine.rsmLineSO.Sales_Order_Line__c}" />
                                                        </td-->
                                                    </tr>
                                                </apex:repeat>
                                            </table>
                                        </div>
                                    </apex:outputpanel>
                                </div>
                                <br/><br/>	
                                <h4 class="modal-title" style="margin-left: 2%;">Current Invoice</h4>
                                <div class="modal-body row" style="margin-left:0.5rem;margin-right:2rem;margin-top:1rem;">
                                    <!-- Display Current invoices -->
                                    <apex:outputpanel rendered="{!SOorPOIdOfSelectedRSMTSM != null}">
                                        <table class="table table-condensed">
                                            <tr>
                                                <th style="padding:5px!important">Invoice #</th>
                                                <th>Invoice <br /> Balance</th>
                                                <th>Product <br /> Balance</th>
                                                <th>Excise <br />Tax <br /> Balance</th>
                                                <th>Due <br /> Date</th>
                                                <th>Payment <br /> Form</th>
                                                <th>Product <br /> Amount</th>
                                                <th>Excise <br />Tax <br /> Amount</th>
                                                <th>Payment <br /> Memo</th>
                                            </tr>
                                            <apex:repeat value="{!currentInvoiceForRSMTSM[SOorPOIdOfSelectedRSMTSM]}" var="invoiceWrapper">
                                                <tr>
                                                    <td>
                                                        <apex:outputlink value="/{!invoiceWrapper.invoiceSO.Id}" target="__blank">{!invoiceWrapper.invoiceSO.Name}</apex:outputlink>
                                                    </td>
                                                    <td>
                                                        <apex:outputfield value="{!invoiceWrapper.invoiceSO.Invoice_Balance__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:outputfield value="{!invoiceWrapper.invoiceSO.Product_Balance__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:outputfield value="{!invoiceWrapper.invoiceSO.Excise_Tax_Balance__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:inputfield value="{!invoiceWrapper.invoiceSO.Invoice_Due_Date__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:inputfield value="{!invoiceWrapper.receivePaymentSO.Payment_Form__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:inputtext value="{!invoiceWrapper.productAmount}" style="width:6rem" />
                                                    </td>
                                                    <td>
                                                        <apex:inputtext value="{!invoiceWrapper.taxAmount}" style="width:6rem" />
                                                    </td>
                                                    <td>
                                                        <apex:inputfield value="{!invoiceWrapper.receivePaymentSO.Payment_Memo__c}" />
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                    </apex:outputpanel>
                                </div>
                                <br/><br/>	
                                <h4 class="modal-title" style="margin-left: 2%;">Open and Pending Invoices</h4>
                                <div class="modal-body row" style="height:250px; margin-left:0.5rem;margin-right:2rem;margin-top:1rem;overflow-y: auto;overflow-x: hidden;">
                                    <!-- Display Pending invoices -->
                                    
                                    <apex:outputpanel rendered="{!accountIdOfSelectedRSMTSM != null}">
                                        <table class="table table-condensed">
                                            <tr>
                                                <th style="padding:5px!important">Invoice #</th>
                                                <th>Invoice <br /> Balance</th>
                                                <th>Product <br /> Balance</th>
                                                <th>Excise <br />Tax <br /> Balance</th>
                                                <th>Due <br /> Date</th>
                                                <th>Payment <br /> Form</th>
                                                <th>Product <br /> Amount</th>
                                                <th>Excise <br />Tax <br /> Amount</th>
                                                <th>Payment <br /> Memo</th>
                                            </tr>

                                            <apex:repeat value="{!pendingInvoiceByAccountId[accountIdOfSelectedRSMTSM]}" var="invoiceWrapper">
                                                <tr>
                                                    <td>
                                                        <apex:outputlink value="/{!invoiceWrapper.invoiceSO.Id}" target="__blank">{!invoiceWrapper.invoiceSO.Name}</apex:outputlink>
                                                    </td>
                                                    <td>
                                                        <apex:outputfield value="{!invoiceWrapper.invoiceSO.Invoice_Balance__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:outputfield value="{!invoiceWrapper.invoiceSO.Product_Balance__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:outputfield value="{!invoiceWrapper.invoiceSO.Excise_Tax_Balance__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:inputfield value="{!invoiceWrapper.invoiceSO.Invoice_Due_Date__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:inputfield value="{!invoiceWrapper.receivePaymentSO.Payment_Form__c}" />
                                                    </td>
                                                    <td>
                                                        <apex:inputtext value="{!invoiceWrapper.productAmount}" style="width:6rem" />
                                                    </td>
                                                    <td>
                                                        <apex:inputtext value="{!invoiceWrapper.taxAmount}" style="width:6rem" />
                                                    </td>
                                                    <td>
                                                        <apex:inputfield value="{!invoiceWrapper.receivePaymentSO.Payment_Memo__c}" />
                                                    </td>
                                                </tr>
                                            </apex:repeat>
                                        </table>
                                    </apex:outputpanel>
                                </div>
                                
                                <!-- Dialog box button section -->
                                <apex:outputpanel id="dialogButtonsId">
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                        <apex:commandbutton styleclass="btn btn-primary"
                                                            value="Ship Confirm"
                                                            action="{!shipCofirmForRSMTSM}"
                                                            rerender="selectedRSMTSMPanel, dialogModalId"
                                                            oncomplete="closeModalWindow('{!hasValidationError}')"
                                                            status="idRefreshingStatus"/>
                                        </div>
                                </apex:outputpanel>
                            </div>
                        </div>
                    </apex:outputpanel>
                </div>
            </div>
        </div>
    </apex:form>
</apex:page>